---
- import_tasks: install.yaml
  when: ansible_os_family == "Debian"
- import_tasks: transport_security.yaml
- import_tasks: config.yaml
- import_tasks: service.yaml

- name: Manage elastic user password
  when: elasticsearch.version is version('8', '>=')
  block:
    - name: Set elastic user password
      import_tasks: password.yaml
  rescue:
    - name: Restart Elasticsearch
      ansible.builtin.service:
        name: elasticsearch
        state: restarted
    - name: Set elastic user password
      import_tasks: password.yaml

- import_tasks: plugins.yaml
- import_tasks: reverse_proxy.yaml
  when: elasticsearch.use_dehydrated
